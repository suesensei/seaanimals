<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sea Animal Matching Game</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #game { display: grid; grid-template-columns: repeat(5, 100px); gap: 10px; justify-content: center; margin-top: 20px; }
    #game img { width: 100px; height: 100px; cursor: pointer; transition: opacity 0.3s, border 0.3s; }
    .correct { opacity: 0.5; }
    .wrong { border: 3px solid red; }
    #score, #result { margin-top: 10px; font-size: 1.2em; }
    #controls { margin-top: 20px; }
    #controls button { margin: 0 5px; padding: 10px 20px; font-size: 1em; }
  </style>
</head>
<body>
  <h1>海の動物マッチングゲーム</h1>
  <div id="score">Score: 0/10</div>
  <div id="controls">
    <button id="start-btn">ゲームを開始</button>
    <button id="repeat-btn" disabled>再生</button>
  </div>
  <div id="game"></div>
  <audio id="audio"></audio>
  <audio id="correct-sound" src="assets/audio/correct.mp3"></audio>
  <audio id="wrong-sound" src="assets/audio/wrong.mp3"></audio>
  <div id="result"></div>
  <script>
    const animals = ["kappa","dolphin","shark","octopus","crab","turtle","squid","crocodile","starfish","clownfish"];
    let shuffled = [];
    let currentRound = 0;
    let score = 0;
    let currentTarget = '';

    const startBtn = document.getElementById('start-btn');
    const repeatBtn = document.getElementById('repeat-btn');
    const gameDiv = document.getElementById('game');
    const scoreDiv = document.getElementById('score');
    const audioPlayer = document.getElementById('audio');
    const correctSound = document.getElementById('correct-sound');
    const wrongSound = document.getElementById('wrong-sound');
    const resultDiv = document.getElementById('result');

    function speak(text, callback) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ja-JP';
      utter.onend = callback;
      window.speechSynthesis.speak(utter);
    }

    startBtn.addEventListener('click', () => {
      startBtn.disabled = true;
      repeatBtn.disabled = true;
      speak('ゲームを始めます。英語を聞いて、あてはまるAnimalをクリックしてください。10問チャレンジしましょう。', initGame);
    });

    repeatBtn.addEventListener('click', () => {
      if (currentTarget) {
        audioPlayer.currentTime = 0;
        audioPlayer.play();
      }
    });

    function initGame() {
      score = 0;
      currentRound = 0;
      shuffled = shuffle(animals.slice());
      scoreDiv.textContent = `Score: ${score}/10`;
      repeatBtn.disabled = false;
      nextRound();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function nextRound() {
      if (currentRound >= 10) {
        endGame();
        return;
      }
      currentTarget = shuffled[currentRound];
      gameDiv.innerHTML = '';
      animals.forEach(animal => {
        const img = document.createElement('img');
        img.src = `assets/images/${animal}.png`;
        img.alt = animal;
        img.dataset.name = animal;
        img.addEventListener('click', handleImageClick);
        gameDiv.appendChild(img);
      });
      audioPlayer.src = `assets/audio/${currentTarget}.mp3`;
      audioPlayer.play();
    }

    function handleImageClick(event) {
      document.querySelectorAll('#game img').forEach(img => img.removeEventListener('click', handleImageClick));
      const selected = event.target.dataset.name;
      if (selected === currentTarget) {
        score++;
        correctSound.play();
        event.target.classList.add('correct');
        showResult('Correct!');
      } else {
        wrongSound.play();
        event.target.classList.add('wrong');
        showResult('Wrong!');
      }
      scoreDiv.textContent = `Score: ${score}/10`;
      currentRound++;
      setTimeout(nextRound, 1000);
    }

    function showResult(msg) {
      resultDiv.textContent = msg;
      setTimeout(() => { resultDiv.textContent = ''; }, 800);
    }

    function endGame() {
      const finalMsg = `おめでとう！${score}個正解です！`;
      speak(finalMsg);
      resultDiv.textContent = finalMsg;
      startBtn.disabled = false;
      startBtn.textContent = 'もう一度';
      repeatBtn.disabled = true;
    }
  </script>
</body>
</html>
